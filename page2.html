<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Locked Rows</title>
  <style>
    body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin: 2rem; }
    .row { display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem; }
    .numbers { font-family: monospace; font-size: 1.1rem; display: flex; gap: 1rem; flex-wrap: wrap; }
    button { padding: 0.5rem 1rem; }
  </style>
</head>
<body>
  <h1>Locked Rows</h1>
  <div id="rows"></div>
  <a href="index.html">â¬… Back to Home</a>

  <!-- ðŸ”Š Sound file (replace "ding.mp3" with your own later) -->
  <audio id="newRowSound" src="HeissUndFettig.mp3" preload="auto"></audio>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    // ðŸ”§ Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCF8rg7QuK6oNBwDgqgxWEes8A_4WvllVU",
      authDomain: "lsv-aperolstand.firebaseapp.com",
      projectId: "lsv-aperolstand",
      storageBucket: "lsv-aperolstand.firebasestorage.app",
      messagingSenderId: "62289008940",
      appId: "1:62289008940:web:db4822f38b0b6fcfe7f489",
      measurementId: "G-N4L6V2XGF0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const names = ["Aperol", "Lillet", "Hugo", "Cuba", "Sekt"];
    const container = document.getElementById("rows");
    const sound = document.getElementById("newRowSound");

    let knownIds = new Set(); // keep track of already shown rows

    function renderRow(row, id) {
      const rowDiv = document.createElement("div");
      rowDiv.className = "row";

      const nums = document.createElement("div");
      nums.className = "numbers";
      nums.textContent = row.values.map((val, i) => `${names[i]}: ${val}`).join(" | ");
      rowDiv.appendChild(nums);

      const delBtn = document.createElement("button");
      delBtn.textContent = "Delete";
      delBtn.addEventListener("click", async () => {
        await deleteDoc(doc(db, "lockedRows", id));
      });
      rowDiv.appendChild(delBtn);

      return rowDiv;
    }

    // Subscribe to lockedRows collection, ordered by timestamp
    const q = query(collection(db, "lockedRows"), orderBy("ts"));
    onSnapshot(q, snapshot => {
      container.innerHTML = "";
      if (snapshot.empty) {
        container.innerHTML = "<p>No rows yet.</p>";
        return;
      }

      snapshot.forEach(docSnap => {
        const id = docSnap.id;
        const rowData = docSnap.data();
        container.appendChild(renderRow(rowData, id));

        // ðŸ”Š Play sound only for *newly added* rows
        if (!knownIds.has(id)) {
          sound.currentTime = 0; // rewind sound
          sound.play().catch(() => {
            // ignore autoplay restrictions until user interacts
          });
        }
        knownIds.add(id);
      });
    });
  </script>
</body>
</html>
